<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>doc-test</title><meta name="description" content="Documentation for doc-test"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">doc-test</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>doc-test</h2></div><div class="tsd-panel tsd-typography"><p><a href="https://classroom.github.com/a/sNC2m9MU"><img src="https://classroom.github.com/assets/deadline-readme-button-24ddc0f5d75046c5622901739e7c5dd533143b0c8e959d652212380cedb1ea36.svg" alt="Review Assignment Due Date"></a></p>
<p><a href="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-ManuelDavidGomezAlonso/actions/workflows/coveralls.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-ManuelDavidGomezAlonso/actions/workflows/coveralls.yml/badge.svg" alt="Coveralls"></a></p>
<p><a href="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-ManuelDavidGomezAlonso/actions/workflows/sonarcloud.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-ManuelDavidGomezAlonso/actions/workflows/sonarcloud.yml/badge.svg" alt="Sonar-Cloud"></a></p>
<p><a href="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-ManuelDavidGomezAlonso/actions/workflows/node.js.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-ManuelDavidGomezAlonso/actions/workflows/node.js.yml/badge.svg" alt="Tests"></a></p>
<a id="md:práctica-11--aplicación-express-para-coleccionistas-de-cartas-magic" class="tsd-anchor"></a><h1><a href="#md:práctica-11--aplicación-express-para-coleccionistas-de-cartas-magic">PRÁCTICA 11 : Aplicación Express para coleccionistas de cartas magic.</a></h1><p><em>Nombre y apellidos: <a href="https://github.com/ManuelDavidGomezAlonso?tab=repositories," title="Enlace Github">Manuel David Gómez Alonso</a></em></p>
<p><em>Asignatura: Desarrollo de Sistemas Informáticos (DSI)</em></p>
<p><a href="https://ull-esit-inf-dsi-2324.github.io/prct11-http-express-magic-app/">Enunciado de la práctica 11</a></p>
<a id="md:índice" class="tsd-anchor"></a><h2><a href="#md:índice">Índice</a></h2><ol>
<li><a href="#md:resumen">Resumen</a></li>
<li><a href="#md:apartados">Apartados</a><ul>
<li><a href="#md:Cambios-en-el-controlador-del-JSON">Cambios en el controlador del JSON</a></li>
<li><a href="#md:Implementacion-del-server">Implementacion del server</a></li>
<li><a href="#md:Pruebas-con-request">Pruebas con express</a></li>
<li><a href="#md:Modificacion">Modificacion</a></li>
</ul>
</li>
<li><a href="#md:alternativas">Problemas</a></li>
<li><a href="#md:referencias">Referencias</a></li>
<li><a href="#md:anexos">Anexos</a></li>
</ol>
<a id="md:resumen" class="tsd-anchor"></a><h2><a href="#md:resumen">Resumen</a></h2><p>Seguimos trabajando con la app de las cartas magic, las funcionalidades son las mismas pero hay cambios significativos. En este caso toda la gestion de ficheros se hará mediante el uso de la api asícrona de node.js, utilizando el patrón de diseño callback para que las pruebas sean más sencillas de realizar.</p>
<p>Además creaemos una API para la gestión de las cartas mediante un servidor express, utilizando peticiones htttp para realizar las diferentes acciones posibles sobre la coleccion de los usuarios.</p>
<blockquote>
<p><strong><a href="#md:índice">Volver al índice</a></strong></p>
</blockquote>
<a id="md:apartados" class="tsd-anchor"></a><h2><a href="#md:apartados">Apartados</a></h2><ul>
<li><a id="md:cambios-en-el-controlador-json" class="tsd-anchor"></a><h3><a href="#md:cambios-en-el-controlador-json">Cambios en el controlador JSON</a></h3></li>
</ul>
<p>Lo primero que hicimos fue empaparnos bien sobre los servidores express, la verdad es que en los apuntes de la asignatura se explica perfectamente su uso, además para realizar peticiones a nuestro server utilizaremos thunder-client, que es bastante intuitivo y facil de utilizar.</p>
<p>Para realizar las pruebas con mocha y chai vamos a usar request (Lo veremos posteriormente). Vamos a hablar rápidamente de los cambios que hemos introducido en el controlador del json.</p>
<a id="md:api-asíncrona" class="tsd-anchor"></a><h3><a href="#md:api-asíncrona">Api Asíncrona.</a></h3><pre><code class="language-typescript"><span class="hl-0">  </span><span class="hl-1">delete</span><span class="hl-0">(</span><span class="hl-2">user</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">, </span><span class="hl-2">cardID</span><span class="hl-0">: </span><span class="hl-3">number</span><span class="hl-0">, </span><span class="hl-4">callback</span><span class="hl-0">: (</span><span class="hl-2">err</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0"> | </span><span class="hl-3">undefined</span><span class="hl-0"> , </span><span class="hl-2">data</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0"> | </span><span class="hl-3">undefined</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-3">void</span><span class="hl-0"> ){</span><br/><span class="hl-0">    </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">filePath</span><span class="hl-0"> = </span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-2">directorioUsuario</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-2">user</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-2">cardID</span><span class="hl-1">}</span><span class="hl-6">.json`</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-4">readFile</span><span class="hl-0">(</span><span class="hl-2">filePath</span><span class="hl-0">, (</span><span class="hl-2">err</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">err</span><span class="hl-0">){</span><br/><span class="hl-0">        </span><span class="hl-4">callback</span><span class="hl-0">(</span><span class="hl-6">&#39;Card or user not found&#39;</span><span class="hl-0">, </span><span class="hl-1">undefined</span><span class="hl-0">);</span><br/><span class="hl-0">      } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-8">// eliminanndo directorio asincornamente</span><br/><span class="hl-0">        </span><span class="hl-2">fs</span><span class="hl-0">.</span><span class="hl-4">unlink</span><span class="hl-0">(</span><span class="hl-2">filePath</span><span class="hl-0">, () </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-4">callback</span><span class="hl-0">(</span><span class="hl-1">undefined</span><span class="hl-0">, </span><span class="hl-6">&#39;Card deleted&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">        });</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  }</span>
</code><button>Copy</button></pre>
<p>Utilizaremos la función <code>delete</code> como ejemplo, podemos ver que se utiliza la api asíncrona para leer el fichero y el patron callback tendra uno de los dos campos posibles a undefined y otro con información ya sean los datos o los posibles errores.</p>
<a id="md:devolución-de-json" class="tsd-anchor"></a><h3><a href="#md:devolución-de-json">Devolución de JSON</a></h3><p>La función <code>showCard</code> y <code>ShowAllCards</code> deberán devolver los correspondientes JSONs para servir correctamente a las consultas de tipo <code>get</code> que se puedan llegar a realizar.</p>
<pre><code class="language-typescript"><span class="hl-0">  </span><span class="hl-4">showAllCards</span><span class="hl-0">(</span><span class="hl-2">user</span><span class="hl-0">: </span><span class="hl-2">string</span><span class="hl-0">, </span><span class="hl-2">callback</span><span class="hl-0">: (</span><span class="hl-2">err</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0"> | </span><span class="hl-3">undefined</span><span class="hl-0"> , </span><span class="hl-2">data</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">[] | </span><span class="hl-3">undefined</span><span class="hl-0"> ) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-1">void</span><span class="hl-0">){</span><br/><span class="hl-0">    </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">cardsArray</span><span class="hl-0">: </span><span class="hl-3">string</span><span class="hl-0">[] = [];</span><br/><span class="hl-0">    </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">dirPath</span><span class="hl-0"> = </span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-2">directorioUsuario</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-2">user</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-2">fs</span><span class="hl-0">.</span><span class="hl-4">readdir</span><span class="hl-0">(</span><span class="hl-2">dirPath</span><span class="hl-0">, (</span><span class="hl-2">err</span><span class="hl-0">, </span><span class="hl-2">files</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">err</span><span class="hl-0">){</span><br/><span class="hl-0">        </span><span class="hl-4">callback</span><span class="hl-0">(</span><span class="hl-6">&#39;User not found&#39;</span><span class="hl-0">, </span><span class="hl-1">undefined</span><span class="hl-0">);</span><br/><span class="hl-0">      } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-2">files</span><span class="hl-0">.</span><span class="hl-4">forEach</span><span class="hl-0">((</span><span class="hl-2">file</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-2">fs</span><span class="hl-0">.</span><span class="hl-4">readFile</span><span class="hl-0">(</span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-2">dirPath</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-2">file</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-0">, (</span><span class="hl-2">err</span><span class="hl-0">, </span><span class="hl-2">file</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-2">cardsArray</span><span class="hl-0">.</span><span class="hl-4">push</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-4">parse</span><span class="hl-0">(</span><span class="hl-2">file</span><span class="hl-0">.</span><span class="hl-4">toString</span><span class="hl-0">()));</span><br/><span class="hl-0">            </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">cardsArray</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0"> === </span><span class="hl-2">files</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0">) {</span><br/><span class="hl-0">              </span><span class="hl-4">callback</span><span class="hl-0">(</span><span class="hl-1">undefined</span><span class="hl-0">, </span><span class="hl-2">cardsArray</span><span class="hl-0">);</span><br/><span class="hl-0">            }</span><br/><br/><span class="hl-0">          });</span><br/><span class="hl-0">        });    </span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">    </span><br/><span class="hl-0">  }</span>
</code><button>Copy</button></pre>
<p>Vemos que cuando el vector de los JSON sea del mismo tamaño que le fichero del usuario el patrón callback lo devolverá.</p>
<pre><code class="language-typescript"><span class="hl-0">  </span><span class="hl-4">showCard</span><span class="hl-0">(</span><span class="hl-2">user</span><span class="hl-0">:</span><span class="hl-2">string</span><span class="hl-0">, </span><span class="hl-2">showIDCard</span><span class="hl-0">: </span><span class="hl-2">number</span><span class="hl-0">, </span><span class="hl-2">callback</span><span class="hl-0">: (</span><br/><span class="hl-0">    </span><span class="hl-2">err</span><span class="hl-0">: </span><span class="hl-2">string</span><span class="hl-0"> | </span><span class="hl-1">undefined</span><span class="hl-0"> , </span><span class="hl-2">data</span><span class="hl-0">: </span><span class="hl-2">string</span><span class="hl-0"> | </span><span class="hl-1">undefined</span><span class="hl-0"> ) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-1">void</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">filePath</span><span class="hl-0"> = </span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-2">directorioUsuario</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-2">user</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-2">showIDCard</span><span class="hl-1">}</span><span class="hl-6">.json`</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-4">readFile</span><span class="hl-0">(</span><span class="hl-2">filePath</span><span class="hl-0">, (</span><span class="hl-2">err</span><span class="hl-0">, </span><span class="hl-2">data</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0">{</span><br/><span class="hl-0">      </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">err</span><span class="hl-0">){</span><br/><span class="hl-0">        </span><span class="hl-4">callback</span><span class="hl-0">(</span><span class="hl-6">&#39;Card or user not found&#39;</span><span class="hl-0">, </span><span class="hl-1">undefined</span><span class="hl-0">);</span><br/><span class="hl-0">      } </span><span class="hl-7">else</span><span class="hl-0"> </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">data</span><span class="hl-0">){</span><br/><span class="hl-0">        </span><span class="hl-4">callback</span><span class="hl-0">(</span><span class="hl-1">undefined</span><span class="hl-0">, </span><span class="hl-2">data</span><span class="hl-0">.</span><span class="hl-4">toString</span><span class="hl-0">());</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  }</span>
</code><button>Copy</button></pre>
<p>En el caso de <code>ShowCard</code> devolverá el json del usuario con el id establecido, si existe en la colección obviamente.</p>
<blockquote>
<p><strong><a href="#md:índice">Volver al índice</a></strong></p>
</blockquote>
<ul>
<li><a id="md:implementacion-del-server" class="tsd-anchor"></a><h3><a href="#md:implementacion-del-server">Implementacion del server.</a></h3></li>
</ul>
<p>A la hora de implementar el server se nos pide que utilicemos las peticiones http <code>get</code>, <code>post</code>, <code>patch</code> y <code>delete</code>, lo haremos de la siguiente manera:</p>
<ul>
<li><strong>Peticiones get</strong></li>
</ul>
<pre><code class="language-typescript"><span class="hl-2">app</span><span class="hl-0">.</span><span class="hl-4">get</span><span class="hl-0">(</span><span class="hl-6">&quot;/cards&quot;</span><span class="hl-0">, (</span><span class="hl-2">req</span><span class="hl-0">, </span><span class="hl-2">res</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0"> = </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-4">jsonCards</span><span class="hl-0">();</span><br/><span class="hl-0">  </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">user</span><span class="hl-0"> &amp;&amp; !</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">cardID</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-2">user</span><span class="hl-0">.</span><span class="hl-4">showAllCards</span><span class="hl-0">(</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">user</span><span class="hl-0">.</span><span class="hl-4">toString</span><span class="hl-0">(),(</span><span class="hl-2">error</span><span class="hl-0">,</span><span class="hl-2">data</span><span class="hl-0">)</span><span class="hl-1">=&gt;</span><span class="hl-0">{</span><br/><span class="hl-0">      </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">error</span><span class="hl-0">) {</span><br/><span class="hl-0">          </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-2">chalk</span><span class="hl-0">.</span><span class="hl-4">red</span><span class="hl-0">(</span><span class="hl-2">error</span><span class="hl-0">));</span><br/><span class="hl-0">          </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-2">error</span><span class="hl-0">);</span><br/><span class="hl-0">      } </span><span class="hl-7">else</span><span class="hl-0"> </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">data</span><span class="hl-0">){</span><br/><span class="hl-0">        </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-2">chalk</span><span class="hl-0">.</span><span class="hl-4">green</span><span class="hl-0">(</span><span class="hl-6">&#39;Showing cards&#39;</span><span class="hl-0">));</span><br/><span class="hl-0">        </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-2">data</span><span class="hl-0">);</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  } </span><span class="hl-7">else</span><span class="hl-0"> </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">user</span><span class="hl-0"> &amp;&amp; </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">cardID</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-2">user</span><span class="hl-0">.</span><span class="hl-4">showCard</span><span class="hl-0">(</span><br/><span class="hl-0">      </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">user</span><span class="hl-0">.</span><span class="hl-4">toString</span><span class="hl-0">(),</span><br/><span class="hl-0">      </span><span class="hl-4">parseInt</span><span class="hl-0">(</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">cardID</span><span class="hl-0">.</span><span class="hl-4">toString</span><span class="hl-0">()),(</span><span class="hl-2">error</span><span class="hl-0">,</span><span class="hl-2">data</span><span class="hl-0">)</span><span class="hl-1">=&gt;</span><span class="hl-0">{</span><br/><span class="hl-0">        </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">error</span><span class="hl-0">) {</span><br/><span class="hl-0">          </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-2">chalk</span><span class="hl-0">.</span><span class="hl-4">red</span><span class="hl-0">(</span><span class="hl-2">error</span><span class="hl-0">));</span><br/><span class="hl-0">          </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-2">error</span><span class="hl-0">);</span><br/><span class="hl-0">        } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-2">chalk</span><span class="hl-0">.</span><span class="hl-4">green</span><span class="hl-0">(</span><span class="hl-6">&#39;Showing card&#39;</span><span class="hl-0">));</span><br/><span class="hl-0">          </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-2">data</span><span class="hl-0">);</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      });</span><br/><span class="hl-0">    } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-6">`&quot;error&quot;: &quot;Error user not valid&quot;`</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  });</span>
</code><button>Copy</button></pre>
<p>La ruta que utilizaremos sera <code>/cards</code>. Si en el link de la petición, en la query string especificamos un <strong>id</strong> de una carta se nos mostrará la misma en caso de que exista, si no hacemos esto, y solo ponemos el nombre del usuario se nos mostrarán todas las cartas de este.</p>
<p>-<strong>Petición post</strong> </p>
<p>Esta petición añadirá cartas a la colección del usuario. Deberemos pasarle en la query el nombre del usuario y el id de la carta.</p>
<pre><code class="language-typescript"><span class="hl-2">app</span><span class="hl-0">.</span><span class="hl-4">post</span><span class="hl-0">(</span><span class="hl-6">&quot;/cards&quot;</span><span class="hl-0">, </span><span class="hl-2">express</span><span class="hl-0">.</span><span class="hl-4">json</span><span class="hl-0">(), (</span><span class="hl-2">req</span><span class="hl-0">, </span><span class="hl-2">res</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0"> = </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-4">jsonCards</span><span class="hl-0">();</span><br/><span class="hl-0">  </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">user</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-7">if</span><span class="hl-0"> (!</span><span class="hl-4">jsonRev</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-4">stringify</span><span class="hl-0">(</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">)).</span><span class="hl-2">error</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">card</span><span class="hl-0">: </span><span class="hl-3">magicCard</span><span class="hl-0"> = </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-4">magicCard</span><span class="hl-0">(</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">user</span><span class="hl-0">.</span><span class="hl-4">toString</span><span class="hl-0">(),</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">id_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">name_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">manaCost_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">color_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">typo_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">rare_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">rules_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">value_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">strRes_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">loyalty_</span><span class="hl-0">,</span><br/><span class="hl-0">      );</span><br/><span class="hl-0">      </span><span class="hl-2">user</span><span class="hl-0">.</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-2">card</span><span class="hl-0">, (</span><span class="hl-2">err</span><span class="hl-0">, </span><span class="hl-2">data</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">err</span><span class="hl-0">) {</span><br/><span class="hl-0">          </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-2">chalk</span><span class="hl-0">.</span><span class="hl-4">red</span><span class="hl-0">(</span><span class="hl-2">err</span><span class="hl-0">));</span><br/><span class="hl-0">          </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-2">err</span><span class="hl-0">);</span><br/><span class="hl-0">        } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-2">chalk</span><span class="hl-0">.</span><span class="hl-4">green</span><span class="hl-0">(</span><span class="hl-2">data</span><span class="hl-0">));</span><br/><span class="hl-0">          </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-2">data</span><span class="hl-0">);</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    );</span><br/><span class="hl-0">    } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">((</span><span class="hl-4">jsonRev</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-4">stringify</span><span class="hl-0">(</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">)).</span><span class="hl-2">error</span><span class="hl-0">));</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-6">&quot;User must be in query string&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">});</span>
</code><button>Copy</button></pre>
<p>Tenemos que pasar en el cuerpo de la petición un json con la carta que desee añadir el usuario y la función <code>jsonRev</code> sirve para verificar si el lore de la carta es el correcto, si no nos devolverá un error.</p>
<ul>
<li><strong>Petición patch</strong></li>
</ul>
<p>Esta petición es la más sencilla, básicamente hace lo mismo que una petición <code>post</code> pero el json a modificar debe existir anteriormente.</p>
<pre><code class="language-typescript"><span class="hl-2">app</span><span class="hl-0">.</span><span class="hl-4">patch</span><span class="hl-0">(</span><span class="hl-6">&quot;/cards&quot;</span><span class="hl-0">, </span><span class="hl-2">express</span><span class="hl-0">.</span><span class="hl-4">json</span><span class="hl-0">(), (</span><span class="hl-2">req</span><span class="hl-0">, </span><span class="hl-2">res</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">action</span><span class="hl-0"> = </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-4">jsonCards</span><span class="hl-0">();</span><br/><span class="hl-0">  </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">card</span><span class="hl-0"> = </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">cardID</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0"> = </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">user</span><span class="hl-0">?.</span><span class="hl-4">toString</span><span class="hl-0">();</span><br/><span class="hl-0">  </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">user</span><span class="hl-0"> &amp;&amp; </span><span class="hl-2">card</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-7">if</span><span class="hl-0"> (!</span><span class="hl-4">jsonRev</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-4">stringify</span><span class="hl-0">(</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">)).</span><span class="hl-2">error</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">card</span><span class="hl-0"> = </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-4">magicCard</span><span class="hl-0">(</span><br/><span class="hl-0">        </span><span class="hl-2">user</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">id_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">name_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">manaCost_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">color_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">typo_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">rare_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">rules_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">value_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">strRes_</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">.</span><span class="hl-2">loyalty_</span><span class="hl-0">,</span><br/><span class="hl-0">      );</span><br/><span class="hl-0">      </span><span class="hl-2">action</span><span class="hl-0">.</span><span class="hl-4">update</span><span class="hl-0">(</span><span class="hl-2">card</span><span class="hl-0">, (</span><span class="hl-2">err</span><span class="hl-0">, </span><span class="hl-2">data</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">err</span><span class="hl-0">) {</span><br/><span class="hl-0">          </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-2">chalk</span><span class="hl-0">.</span><span class="hl-4">red</span><span class="hl-0">(</span><span class="hl-2">err</span><span class="hl-0">));</span><br/><span class="hl-0">          </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-2">err</span><span class="hl-0">);</span><br/><span class="hl-0">        } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-2">chalk</span><span class="hl-0">.</span><span class="hl-4">green</span><span class="hl-0">(</span><span class="hl-2">data</span><span class="hl-0">));</span><br/><span class="hl-0">          </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-2">data</span><span class="hl-0">);</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">    } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-4">jsonRev</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-4">stringify</span><span class="hl-0">(</span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">body</span><span class="hl-0">)));</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-6">&quot;Error user or ID not valid&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">});</span>
</code><button>Copy</button></pre>
<ul>
<li><strong>Petición delete</strong></li>
</ul>
<p>La petición <code>delete</code> se encargará de borrar las cartas no deseadas por el usuario, para ello le pasaremos en la query el id y le nombre del usuario.</p>
<pre><code class="language-typescript"><span class="hl-2">app</span><span class="hl-0">.</span><span class="hl-4">delete</span><span class="hl-0">(</span><span class="hl-6">&quot;/cards&quot;</span><span class="hl-0">, (</span><span class="hl-2">req</span><span class="hl-0">, </span><span class="hl-2">res</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">action</span><span class="hl-0"> = </span><span class="hl-1">new</span><span class="hl-0"> </span><span class="hl-4">jsonCards</span><span class="hl-0">();</span><br/><span class="hl-0">  </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">card</span><span class="hl-0"> = </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">cardID</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-1">const</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0"> = </span><span class="hl-2">req</span><span class="hl-0">.</span><span class="hl-2">query</span><span class="hl-0">.</span><span class="hl-2">user</span><span class="hl-0">?.</span><span class="hl-4">toString</span><span class="hl-0">();</span><br/><span class="hl-0">  </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">user</span><span class="hl-0"> &amp;&amp; </span><span class="hl-2">card</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-2">action</span><span class="hl-0">.</span><span class="hl-4">delete</span><span class="hl-0">(</span><span class="hl-2">user</span><span class="hl-0">, </span><span class="hl-4">parseInt</span><span class="hl-0">(</span><span class="hl-2">card</span><span class="hl-0">.</span><span class="hl-4">toString</span><span class="hl-0">()),(</span><span class="hl-2">err</span><span class="hl-0">,</span><span class="hl-2">data</span><span class="hl-0">)</span><span class="hl-1">=&gt;</span><span class="hl-0">{</span><br/><span class="hl-0">      </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">err</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-2">chalk</span><span class="hl-0">.</span><span class="hl-4">red</span><span class="hl-0">(</span><span class="hl-2">err</span><span class="hl-0">));</span><br/><span class="hl-0">        </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-2">err</span><span class="hl-0">);</span><br/><span class="hl-0">      } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-2">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-2">chalk</span><span class="hl-0">.</span><span class="hl-4">green</span><span class="hl-0">(</span><span class="hl-2">data</span><span class="hl-0">));</span><br/><span class="hl-0">        </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-2">data</span><span class="hl-0">);</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">res</span><span class="hl-0">.</span><span class="hl-4">send</span><span class="hl-0">(</span><span class="hl-6">&quot;Error user or ID not valid&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">});</span>
</code><button>Copy</button></pre>
<blockquote>
<p><strong><a href="#md:índice">Volver al índice</a></strong></p>
</blockquote>
<ul>
<li><a id="md:pruebas-con-request" class="tsd-anchor"></a><h3><a href="#md:pruebas-con-request">Pruebas con request.</a></h3></li>
</ul>
<pre><code class="language-typescript"><span class="hl-0">  </span><span class="hl-4">it</span><span class="hl-0">(</span><span class="hl-6">&#39;should add a card with bad lore&#39;</span><span class="hl-0">, (</span><span class="hl-2">done</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">request</span><span class="hl-0">.</span><span class="hl-4">post</span><span class="hl-0">(</span><span class="hl-6">&#39;http://localhost:3000/cards?user=jose&#39;</span><span class="hl-0">, {</span><br/><span class="hl-0">      </span><span class="hl-2">json:</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;user_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-6">&quot;jose&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;id_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-9">0</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;name_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-6">&quot;Cazador&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;manaCost_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-9">16</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;color_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-6">&quot;multicolor&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;typo_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-6">&quot;creature&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;rare_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-6">&quot;mythicRare&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;rules_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-6">&quot;No puede atacar cuerpo a cuerpo&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;value_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-9">150</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;strRes_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-9">100</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-6">&quot;loyalty_&quot;</span><span class="hl-2">:</span><span class="hl-0"> </span><span class="hl-9">1000</span><br/><span class="hl-0">      },</span><br/><span class="hl-0">    }, (</span><span class="hl-2">error</span><span class="hl-0">, </span><span class="hl-2">response</span><span class="hl-0">, </span><span class="hl-2">body</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">expect</span><span class="hl-0">(</span><span class="hl-2">response</span><span class="hl-0">.</span><span class="hl-2">statusCode</span><span class="hl-0">).</span><span class="hl-2">to</span><span class="hl-0">.</span><span class="hl-4">equal</span><span class="hl-0">(</span><span class="hl-9">200</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-4">expect</span><span class="hl-0">(</span><span class="hl-2">body</span><span class="hl-0">).</span><span class="hl-2">to</span><span class="hl-0">.</span><span class="hl-4">equal</span><span class="hl-0">(</span><span class="hl-6">&#39;Loyalty is only for planeswalker type&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-4">done</span><span class="hl-0">();</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  });</span>
</code><button>Copy</button></pre>
<p>Para hacer las pruebas utilizaremos request que recibe como parámetros de una consulta, <strong>el tipo de petición</strong>, <strong>la url base</strong>, <strong>la query string</strong> y <strong>El cuerpo</strong>.
En <code>response</code> se almacenará la respuesta del server y es lo que utilizaremos para comprobar el correcto funcionamiento de este.</p>
<blockquote>
<p><strong><a href="#md:índice">Volver al índice</a></strong></p>
</blockquote>
<a id="md:modificacion" class="tsd-anchor"></a><h3><a href="#md:modificacion">Modificacion.</a></h3><p>En cuanto a la modificación, básicamente fue implementar dos funciones de gestión de cartas magic con la api asícrona y el patrón callback, como hemos hecho en el resto de la practica.</p>
<pre><code class="language-typescript"><span class="hl-0">  </span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-2">card</span><span class="hl-0">: </span><span class="hl-2">magicCard</span><span class="hl-0">, </span><span class="hl-2">callback</span><span class="hl-0">: (</span><br/><span class="hl-0">    </span><span class="hl-2">err</span><span class="hl-0">: </span><span class="hl-2">string</span><span class="hl-0"> | </span><span class="hl-1">undefined</span><span class="hl-0"> ,</span><span class="hl-2">data</span><span class="hl-0">: </span><span class="hl-2">string</span><span class="hl-0"> | </span><span class="hl-1">undefined</span><span class="hl-0"> ) </span><span class="hl-1">=&gt;</span><span class="hl-0"> </span><span class="hl-1">void</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-4">readFile</span><span class="hl-0">(</span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-2">directorioUsuario</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-2">card</span><span class="hl-10">.</span><span class="hl-2">id_</span><span class="hl-1">}</span><span class="hl-6">.json`</span><span class="hl-0">, (</span><span class="hl-2">err</span><span class="hl-0">) </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-7">if</span><span class="hl-0"> (</span><span class="hl-2">err</span><span class="hl-0">){</span><br/><span class="hl-0">            </span><span class="hl-4">writeFile</span><span class="hl-0">(</span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-2">directorioUsuario</span><span class="hl-1">}</span><span class="hl-6">/</span><span class="hl-1">${</span><span class="hl-2">card</span><span class="hl-10">.</span><span class="hl-2">id_</span><span class="hl-1">}</span><span class="hl-6">.json`</span><span class="hl-0">, </span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-4">stringify</span><span class="hl-0">(</span><span class="hl-2">card</span><span class="hl-0">),() </span><span class="hl-1">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">              </span><span class="hl-4">callback</span><span class="hl-0">(</span><span class="hl-1">undefined</span><span class="hl-0">, </span><span class="hl-6">&#39;Card Added&#39;</span><span class="hl-0">)</span><br/><span class="hl-0">            });</span><br/><span class="hl-0">          } </span><span class="hl-7">else</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-4">callback</span><span class="hl-0">(</span><span class="hl-6">&#39;Card alredy exist&#39;</span><span class="hl-0">, </span><span class="hl-1">undefined</span><span class="hl-0">);            </span><br/><span class="hl-0">          }</span><br/><span class="hl-0">        });</span><br/><span class="hl-0">  }</span>
</code><button>Copy</button></pre>
<p>Vemos como se devuelve <strong>Card Added</strong> si la carta se añade y <strong>Card already exist</strong> si ya existe la carta.</p>
<blockquote>
<p><strong><a href="#md:índice">Volver al índice</a></strong></p>
</blockquote>
<a id="md:referencias" class="tsd-anchor"></a><h2><a href="#md:referencias">Referencias</a></h2><p><a href="#md:https://sonarcloud.io/project/configuration/GitHubActions?id=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct11-http-express-magic-app-ManuelDavidGomezAlonso">SonarCloud</a>
<a href="https://ull-esit-inf-dsi-2324.github.io/prct11-http-express-magic-app/">Enunciado de la práctica 11</a></p>
<blockquote>
<p><strong><a href="#md:índice">Volver al índice</a></strong></p>
</blockquote>
<a id="md:anexos" class="tsd-anchor"></a><h2><a href="#md:anexos">Anexos</a></h2><p><a href="#md:https://learning-oreilly-com.accedys2.bbtk.ull.es/library/view/essential-typescript-from/9781484249796/html/481342_1_En_1_Chapter.xhtml">Essential TypeScript</a></p>
<blockquote>
<p><strong><a href="#md:índice">Volver al índice</a></strong></p>
</blockquote>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:práctica-11--aplicación-express-para-coleccionistas-de-cartas-magic"><span>PRÁCTICA 11 : <wbr/>Aplicación <wbr/>Express para coleccionistas de cartas magic.</span></a><ul><li><a href="#md:índice"><span>Índice</span></a></li><li><a href="#md:resumen"><span>Resumen</span></a></li><li><a href="#md:apartados"><span>Apartados</span></a></li><li><ul><li><a href="#md:cambios-en-el-controlador-json"><span>Cambios en el controlador JSON</span></a></li><li><a href="#md:api-asíncrona"><span>Api <wbr/>Asíncrona.</span></a></li><li><a href="#md:devolución-de-json"><span>Devolución de JSON</span></a></li><li><a href="#md:implementacion-del-server"><span>Implementacion del server.</span></a></li><li><a href="#md:pruebas-con-request"><span>Pruebas con request.</span></a></li><li><a href="#md:modificacion"><span>Modificacion.</span></a></li></ul></li><li><a href="#md:referencias"><span>Referencias</span></a></li><li><a href="#md:anexos"><span>Anexos</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>doc-test</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>